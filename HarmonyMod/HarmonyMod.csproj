<Project Sdk="Microsoft.NET.Sdk" DefaultTargets="Build">
  <PropertyGroup>
    <ProjectGuid>{1821BC25-9494-40B7-8229-945C60C16BC2}</ProjectGuid>
    <TargetFramework>net35</TargetFramework>
    <Deterministic>false</Deterministic>
    <AssemblyTitle>HarmonyMod</AssemblyTitle>
    <Configurations>Debug;Release;Beta;Developer-Updater;Developer</Configurations>
	   <!--

		IMPORTANT, FIXME:

		The Developer config should be built first, then Developer-Updater, for each source change

		The batch build makes them in the opposite order, which means the Developer-Update output folder
		will contain the last version of Developer, not the current version.

		I don't know how to fix it. If you do, please drop me a note. Thank you



	   -->
		<GenerateAssemblyFileVersionAttribute>false</GenerateAssemblyFileVersionAttribute>
		<GenerateAssemblyVersionAttribute>false</GenerateAssemblyVersionAttribute>
		<GenerateAssemblyCompanyAttribute>false</GenerateAssemblyCompanyAttribute>
		<GenerateAssemblyInformationalVersionAttribute>false</GenerateAssemblyInformationalVersionAttribute>
		<GenerateAssemblyProductAttribute>false</GenerateAssemblyProductAttribute>
		<GenerateAssemblyTitleAttribute>false</GenerateAssemblyTitleAttribute>
		<AssemblyName>HarmonyMod</AssemblyName>
		<PackageId>Harmony-CitiesSkylines</PackageId>
		<Authors>Radu Hociung</Authors>
		<Description>This is a mod for Cities: Skylines that provides common infrastructure like patching (using Andreas Pardeike' Harmony),
compatibility management, exception management, etc</Description>
		<Copyright>2021</Copyright>
		<RepositoryUrl>https://github.com/drok/Harmony-CitiesSkylines</RepositoryUrl>
	  <LangVersion>latest</LangVersion>
	  <AutoGenerateBindingRedirects>false</AutoGenerateBindingRedirects>
  </PropertyGroup>
	<PropertyGroup>
		<DelaySign>false</DelaySign>
		<SignAssembly>true</SignAssembly>
		<AssemblyOriginatorKeyFile>Properties\StrongName.pfx</AssemblyOriginatorKeyFile>
		<AutoGenerateBindingRedirects>false</AutoGenerateBindingRedirects>
		<UserSecretsId>631fdc66-d970-44a9-9df3-895a0745b50e</UserSecretsId>
	</PropertyGroup>
	<ItemGroup>
	  <Compile Remove="Json.NetMF\nuspec\**" />
	  <Compile Remove="Json.NetMF\source\Json.NetMF\Properties\**" />
	  <Compile Remove="Json.NetMF\source\nanoFramework.Json\**" />
	  <Compile Remove="Json.NetMF\source\Test\**" />
	  <Compile Remove="Priority-Queue\Priority Queue Benchmarks\**" />
	  <Compile Remove="Priority-Queue\Priority Queue Example\**" />
	  <Compile Remove="Priority-Queue\Priority Queue Net Standard\**" />
	  <Compile Remove="Priority-Queue\Priority Queue PCL\**" />
	  <Compile Remove="Priority-Queue\Priority Queue Tests\**" />
	  <Compile Remove="Priority-Queue\Priority Queue Unity Full\**" />
	  <Compile Remove="Priority-Queue\Priority Queue Unity Subset\**" />
	  <Compile Remove="Priority-Queue\Priority Queue\Properties\**" />
	  <EmbeddedResource Remove="Json.NetMF\nuspec\**" />
	  <EmbeddedResource Remove="Json.NetMF\source\Json.NetMF\Properties\**" />
	  <EmbeddedResource Remove="Json.NetMF\source\nanoFramework.Json\**" />
	  <EmbeddedResource Remove="Json.NetMF\source\Test\**" />
	  <EmbeddedResource Remove="Priority-Queue\Priority Queue Benchmarks\**" />
	  <EmbeddedResource Remove="Priority-Queue\Priority Queue Example\**" />
	  <EmbeddedResource Remove="Priority-Queue\Priority Queue Net Standard\**" />
	  <EmbeddedResource Remove="Priority-Queue\Priority Queue PCL\**" />
	  <EmbeddedResource Remove="Priority-Queue\Priority Queue Tests\**" />
	  <EmbeddedResource Remove="Priority-Queue\Priority Queue Unity Full\**" />
	  <EmbeddedResource Remove="Priority-Queue\Priority Queue Unity Subset\**" />
	  <EmbeddedResource Remove="Priority-Queue\Priority Queue\Properties\**" />
	  <None Remove="Json.NetMF\nuspec\**" />
	  <None Remove="Json.NetMF\source\Json.NetMF\Properties\**" />
	  <None Remove="Json.NetMF\source\nanoFramework.Json\**" />
	  <None Remove="Json.NetMF\source\Test\**" />
	  <None Remove="Priority-Queue\Priority Queue Benchmarks\**" />
	  <None Remove="Priority-Queue\Priority Queue Example\**" />
	  <None Remove="Priority-Queue\Priority Queue Net Standard\**" />
	  <None Remove="Priority-Queue\Priority Queue PCL\**" />
	  <None Remove="Priority-Queue\Priority Queue Tests\**" />
	  <None Remove="Priority-Queue\Priority Queue Unity Full\**" />
	  <None Remove="Priority-Queue\Priority Queue Unity Subset\**" />
	  <None Remove="Priority-Queue\Priority Queue\Properties\**" />
	</ItemGroup>
	<ItemGroup>
	  <Compile Remove="Priority-Queue\Priority Queue\FastPriorityQueue.cs" />
	  <Compile Remove="Priority-Queue\Priority Queue\FastPriorityQueueNode.cs" />
	  <Compile Remove="Priority-Queue\Priority Queue\StablePriorityQueue.cs" />
	  <Compile Remove="Priority-Queue\Priority Queue\StablePriorityQueueNode.cs" />
	</ItemGroup>
	<ItemGroup>
	  <None Remove="Json.NetMF\.git" />
	  <None Remove="Json.NetMF\.gitattributes" />
	  <None Remove="Json.NetMF\.gitignore" />
	  <None Remove="Json.NetMF\azure-pipelines.yml" />
	  <None Remove="Json.NetMF\CODE_OF_CONDUCT.md" />
	  <None Remove="Json.NetMF\LICENSE" />
	  <None Remove="Json.NetMF\README.md" />
	  <None Remove="Json.NetMF\source\Json.NetMF\packages.config" />
	  <None Remove="Json.NetMF\source\NuGet.Config" />
	  <None Remove="Json.NetMF\source\version.json" />
	  <None Remove="Priority-Queue\.git" />
	  <None Remove="Priority-Queue\.gitignore" />
	  <None Remove="Priority-Queue\LICENSE.txt" />
	  <None Remove="Priority-Queue\Priority Queue\packages.config" />
	  <None Remove="Priority-Queue\Priority Queue\Priority Queue.nuspec" />
	  <None Remove="Priority-Queue\Priority Queue\Priority Queue.snk" />
	  <None Remove="Priority-Queue\README.md" />
	  <None Remove="Resources\HarmonyMod-0.9.0.1.dll" />
	</ItemGroup>
	<ItemGroup>
    <ProjectReference Include="..\Compat-CitiesHarmony-Mod\Compat-CitiesHarmony-Mod.csproj">
		<ReferenceOutputAssembly>true</ReferenceOutputAssembly>
		<Private Condition="'$(Configuration)'!='Developer-Updater' and '$(Configuration)'!='Developer'">true</Private>
		<Private Condition="'$(Configuration)'=='Developer-Updater' or '$(Configuration)'=='Developer'">false</Private>
		<CopyLocalSatelliteAssemblies>false</CopyLocalSatelliteAssemblies>
    </ProjectReference>
    <ProjectReference Include="..\Compat-CitiesHarmony.Harmony-2.0.4.0\Harmony\Compat-CitiesHarmony.Harmony-2.0.4.0.csproj">
      <Aliases>HarmonyCHH2040</Aliases>
    </ProjectReference>
    <ProjectReference Include="..\Harmony-v2\Harmony\Harmony-v2.csproj">
      <Aliases>Harmony2</Aliases>
      <ReferenceOutputAssembly>true</ReferenceOutputAssembly>
      <Private Condition="'$(Configuration)'!='Developer-Updater' and '$(Configuration)'!='Developer'">true</Private>
      <Private Condition="'$(Configuration)'=='Developer-Updater' or '$(Configuration)'=='Developer'">false</Private>
      <CopyLocalSatelliteAssemblies>false</CopyLocalSatelliteAssemblies>
    </ProjectReference>
    <ProjectReference Include="..\IAmAware\IAwareness0.csproj" />
    <ProjectReference Include="..\MonoMod.Common\MonoMod.Common.csproj" />
    <Reference Include="Assembly-CSharp">
      <HintPath>C:\References\Assembly-CSharp.dll</HintPath>
      <Private>False</Private>
    </Reference>
    <Reference Include="ColossalManaged">
      <HintPath>C:\References\ColossalManaged.dll</HintPath>
      <Private>False</Private>
    </Reference>
    <Reference Include="ICities">
      <HintPath>C:\References\ICities.dll</HintPath>
      <Private>False</Private>
    </Reference>
    <Reference Include="ICSharpCode.SharpZipLib">
      <HintPath>C:\References\ICSharpCode.SharpZipLib.dll</HintPath>
      <Private>false</Private>
    </Reference>
    <Reference Include="UnityEngine">
      <HintPath>C:\References\UnityEngine.dll</HintPath>
      <Private>False</Private>
    </Reference>
  </ItemGroup>
	<ItemGroup>
		<EmbeddedResource Include="Resources\HarmonyLogo.png">
		  <CopyToOutputDirectory>Never</CopyToOutputDirectory>
		</EmbeddedResource>
	</ItemGroup>
       <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|AnyCPU'">
    <TreatWarningsAsErrors>false</TreatWarningsAsErrors>
    <WarningsAsErrors>;NU1605</WarningsAsErrors>
    <DefineConstants></DefineConstants>
  </PropertyGroup>
	<PropertyGroup Condition="'$(Configuration)'!='Release'">
		<Optimize>false</Optimize>
		<DebugType>full</DebugType>
		<DebugSymbols>true</DebugSymbols>
	</PropertyGroup>

	<PropertyGroup Condition="'$(Configuration)'=='Release'">
		<Optimize>true</Optimize>
		<DebugType>none</DebugType>
		<DebugSymbols>false</DebugSymbols>
	</PropertyGroup>

  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Beta|AnyCPU'">
    <DefineConstants>TRACE;UNITY_ASSERTIONS</DefineConstants>
  </PropertyGroup>

  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Developer|AnyCPU'">
    <DefineConstants>TRACE;DEVELOPER</DefineConstants>
  </PropertyGroup>

  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Developer-Updater|AnyCPU'">
    <DefineConstants>TRACE;DEVELOPER;DEVELOPER_UPDATER</DefineConstants>
  </PropertyGroup>

  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|AnyCPU'">
    <DefineConstants>DEBUG;TRACE;HEAVY_TRACE;UNITY_ASSERTIONS</DefineConstants>
  </PropertyGroup>

	<ItemGroup Condition="'$(Configuration)'=='Developer-Updater'">
	  <Content Include="bin\Developer\$(TargetFramework)\$(TargetFileName)">
	    <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
	    <Link>HarmonyMod_helper_dll</Link>
	  </Content>
		<Content Include="bin\Developer\$(TargetFramework)\$(TargetName).pdb">
			<CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
			<Link>HarmonyMod_helper_pdb</Link>
		</Content>
	</ItemGroup>

	<!-- Gihub Release:
			gh release create v2.2 - -title "Release no. 2.2" - -notes "4rd release" - -target maintenance-0.9 bin/Harmony-CitiesSkylines-Debug.zip\#"Mod Archive" bin/Thumbnail.png\#"Simple Thumbnail"
	-->
	<Target Name="DeployToModDirectory" AfterTargets="Build" Condition="'$(Configuration)'!='Developer'">
	<PropertyGroup>
		<SteamPath>~/Library/Application Support/Steam/</SteamPath>
		<SteamPath Condition="! Exists ('$(SteamPath)')">$(ProgramFiles)\Steam</SteamPath>
		<SteamPath Condition="! Exists ('$(SteamPath)')">$(Registry:HKEY_CURRENT_USER\Software\Valve\Steam@SteamPath)</SteamPath>
		<CSPath>$(SteamPath)\steamapps\common\Cities_Skylines</CSPath>
		<!-- If the mod author's CSL is installed in a place other than the default Steam library, you can add below the path to it -->
		<CSPath Condition="!  Exists ('$(CSPath)')">F:\SteamLibrary\steamapps\common\Cities_Skylines</CSPath>
		<!-- End Custom CSL Install path -->
		<MangedDLLPath>$(CSPath)\Cities_Data\Managed</MangedDLLPath>
		<MangedDLLPath Condition="!  Exists ('$(MangedDLLPath)')">..\dependencies</MangedDLLPath>
		<UnityPath>$(MSBuildExtensionsPath64)\..\Unity\</UnityPath>
		<!-- If the mod author's Unity is installed in other than the default locations, specify it below.
			It is used to generate .mdb debug symbol files
		-->
		<UnityPath Condition="! Exists ('$(UnityPath)')">H:\Programs\Unity\</UnityPath>
		<!-- End Custom Unity Install path -->
		<UnityPath Condition="! Exists ('$(UnityPath)')">..\Unity\</UnityPath>
		<ModDirectory>$(LOCALAPPDATA)\Colossal Order\Cities_Skylines\Addons\Mods\$(SolutionName)-$(Configuration)\</ModDirectory>
	</PropertyGroup>

    <ItemGroup Condition="'$(Configuration)'=='Developer-Updater'">
      <ModFiles Include="$(TargetDir)$(TargetName).dll" />
      <ModFiles Include="$(TargetDir)$(TargetName).dll.mdb" />
      <ModFiles Include="$(TargetDir)$(TargetName)_helper_dll" />
      <ModFiles Include="$(TargetDir)$(TargetName)_helper_pdb" />
    </ItemGroup>

    <ItemGroup Condition="'$(Configuration)'!='Developer' and '$(Configuration)'!='Developer-Updater'">
	  <ModFiles Include="$(TargetDir)*.dll" />
      <ModFiles Include="$(TargetDir)*.dll.mdb" />
      <ModFiles Include="$(TargetDir)*.dll.config" />
    </ItemGroup>
		<Exec Condition="'$(Configuration)'!='Release'" Command="$(UnityPath)Editor\Data\MonoBleedingEdge\bin\mono.exe $(UnityPath)Editor\Data\MonoBleedingEdge\lib\mono\4.5\pdb2mdb.exe $(TargetDir)$(TargetName).dll" />
		<Message Text="Installing to Local Mod directory as $(SolutionName)-$(Configuration)" />
    <!-- <RemoveDir Directories="$(ModDirectory)" /> -->
    <Copy SourceFiles="@(ModFiles)" DestinationFolder="$(ModDirectory)" />
  </Target>
</Project>
